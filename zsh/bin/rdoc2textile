#!/usr/bin/env ruby

$stdin.each_line do |line|
  if @in_pre and line.match(/^[^ \t]/)
    puts "</pre>"
    @in_pre = false
  end

  if m = line.match(/^(=+)/)
    count = m[1].length

    # hack for pmade.com
    count = case count
            when 1: 2
            when 2: 4
            when 3: 5
            else    6
            end
    # end hack for pmade.com

    line.sub!(/^=+/, "h#{count}.")
  elsif line.match(/^\d+\./)
    line.sub!(/^\d+\./, '#')
  elsif !@in_pre and line.match(/^[ \t]/)
    puts "<pre>"
    @in_pre = true
  end

  line.gsub!(/(http:\/\/\S+)/, '"\1":\1')
  print line
end
