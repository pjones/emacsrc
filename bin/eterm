#!/usr/bin/env bash

################################################################################
# Create a new Emacs frame running a terminal.
set -e

################################################################################
option_command=zsh
option_keep=nil
passthrough=("-c")

################################################################################
usage() {
  cat <<EOF
Usage: $(basename "$0") [options]

  -h      This message
  -n      Run neofetch for testing
  -s NAME Use server NAME instead of the default

EOF
}

################################################################################
while getopts "hns:" o; do
  case "${o}" in
  h)
    usage
    exit
    ;;

  n)
    option_command="neofetch"
    option_keep=t
    ;;

  s)
    passthrough+=("-s" "$OPTARG")
    ;;

  *)
    exit 1
    ;;
  esac
done

shift $((OPTIND - 1))

################################################################################
e "${passthrough[@]}" -- \
  -F '((name . "eterm"))' \
  --eval "(pjones:vterm \"$option_command\" $option_keep)" \
  >/dev/null 2>&1
