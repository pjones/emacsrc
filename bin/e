#!/bin/bash

################################################################################
# A very simple wrapper around emacsclient.
set -e

################################################################################
option_server_name="server"
option_server_path="$HOME/.cache/emacs/server/"
option_emacs_opts=()

################################################################################
usage () {
cat <<EOF
Usage: e [options] [file] -- [emacsclient options]

  -c      Open a new frame
  -h      This message
  -s NAME Connect to server NAME
  -t      Open a new TTY
EOF
}

################################################################################
while getopts "chs:t" o; do
  case "${o}" in
    c) option_emacs_opts+=("--create-frame" "--no-wait")
       ;;

    h) usage
       exit
       ;;

    s) option_server_name=$OPTARG
       ;;

    t) option_emacs_opts+=("--tty")
       ;;

    *) exit 1
       ;;
  esac
done

shift $((OPTIND-1))

################################################################################
if [ ! -e "${option_server_path}${option_server_name}" ]; then
  emacs --daemon="$option_server_name"
fi

################################################################################
emacsclient --server-file="${option_server_path}${option_server_name}" \
            "${option_emacs_opts[@]}" "$@"
